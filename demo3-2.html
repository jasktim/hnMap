<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Moving Trajectory</title>
    <!-- 引入腾讯地图 JavaScript API -->
    <script src="https://map.qq.com/api/js?v=2.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
    <style>
        #map {
            width: 100%;
            height: 400px; /* 设置地图容器的高度 */
        }
    </style>
</head>
<body>
<!-- 地图容器 -->
<div id="map" style="width: 100%; height: 750px;"></div>

<script>
    // 初始化地图对象
    var map = new qq.maps.Map(document.getElementById('map'), {
        center: new qq.maps.LatLng(39.916527, 116.397128), // 北京市中心坐标
        zoom: 18 // 缩放级别
    });

    var marker = new TMap.MultiMarker({
        id: 'marker',
        map: map,
        styles: {
            'start': new TMap.MarkerStyle({
                anchor: {
                    x: 16,
                    y: 32,
                },
                src: 'https://mapapi.qq.com/web/miniprogram/demoCenter/images/marker-start.png',
            }),
        }
    });

    // 初始化轨迹线条
    var path = new qq.maps.Polyline({
        path: [],
        map: map,
        strokeColor: '#FF0000',
        strokeWeight: 3
    });

    // 定义位置变化回调函数
    function updatePosition(position) {
        var latLng = new qq.maps.LatLng(position.coords.latitude, position.coords.longitude);
        map.setCenter(latLng);
        // 将新的位置坐标添加到轨迹路径中
        path.getPath().push(latLng);

        // 更新轨迹线条
        path.setPath(path.getPath());

        // 移动地图中心到当前位置
        map.panTo(latLng);
    }

    // 开始监听位置变化
    if (navigator.geolocation) {
        var watchId = navigator.geolocation.watchPosition(updatePosition);
    } else {
        alert('浏览器不支持地理定位功能！');
    }
</script>
</body>
</html>
